# 数据库连接池

- 概念：用于存放数据库连接的容器
  - 当系统初始化好了以后，容器就被创建，容器中会申请一些连接对象，当用户访问数据库时，从容器中获取连接对象，用户访问完成后，会将连接对象归还个容器
- 好处：
  - 节约资源
  - 用户访问搞笑
- 实现
  - 标准的接口：DataSource
    - 方法：
      - 获取连接：getConnection()
      - 归还连接：如果连接对象Connection是从连接池中获取的，那么调用Connection.close()方法。则不会再关闭连接了，而是归还连接
  - 一般是用数据库产商实现

## C3P0连接池

1. 使用步骤
   1. 导入jar包，c3p0-0.9.5.2.jar     mchange-commons-java-0.2.12.jar
   2. 定义配置文件
      1. 名称：c3p0.properties或者c3p0-config.xml
      2. 路径：默认在项目的类路径下
   3. 创建核心对象：数据库连接对象  ComboPoolDataSource
   4. 获取连接：getConnection()

```xml
<c3p0-config>
    <!--使用默认的配置读取连接池对象-->
    <default-config>
        <!--连接参数-->
        <property name="droverClass">com.mysql.cj.jdbc.Driver</property>
        <property name="jdbcUrl">jdbc:mysql://localhost:3306/student?useSSL=FALSE&amp;serverTimezone=UTC</property>
        <property name="user">root</property>
        <property name="password">zhouwei1997</property>
        <!--连接池参数-->
        <property name="initialPoolSIze">5</property>
        <property name="maxPoolSIze">10</property>
        <property name="checkoutTimeout">3000</property>
    </default-config>

    <named-config name="otherc3p0">
        <!--连接参数-->
        <property name="droverClass">com.mysql.cj.jdbc.Driver</property>
        <property name="jdbcUrl">jdbc:mysql://localhost:3306/student?useSSL=FALSE&amp;serverTimezone=UTC</property>
        <property name="user">root</property>
        <property name="password">zhouwei1997</property>
        <!--连接池参数-->
        <property name="initialPoolSIze">5</property>
        <property name="maxPoolSIze">8</property>
        <property name="checkoutTimeout">5000</property>
    </named-config>
</c3p0-config>
```

~~~java
import com.mchange.v2.c3p0.ComboPooledDataSource;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.SQLException;

/**
 * @Author:hengyu
 * @Date:2020/9/15 13:50
 * @Version:1.0
 * @Discription: C3P0演示
 */
public class C3P0Demo {

    public static void main(String[] args) throws SQLException {

            //创建数据库连接对象
            DataSource dataSource = new ComboPooledDataSource();
            //获取连接对象
            Connection connection = dataSource.getConnection();
            System.out.println(connection);
            connection.close();
    }
~~~

## druid连接池

1. 使用步骤
   1. 导入jar包 druid-1.0.9.jar
   
   2. 定义配置文件
      
      1. 导入jar包  druid-1.0.9.jar
      2. 定义配置文件
          1. properties形式的
          2. 可以叫任意的名称，可以放在任意的目录下
      
     ```properties
      driverClassName=com.mysql.cj.jdbc.Driver
      url=jdbc:mysql://localhost:3306/student?useSSL=FALSE&amp;serverTimezone=UTC
      username=root
      password=zhouwei1997
      initialSize=5
      maxActive=20
      maxWait=3000
     ```
   
   3. 获取数据库连接池对象：通过工厂类来获取  DruidDataSourceFactory
   4. 获取连接：getConnection
   
   ```java
   package com.hengyu;
   
   import com.alibaba.druid.pool.DruidDataSource;
   import com.alibaba.druid.pool.DruidDataSourceFactory;
   
   import javax.sql.DataSource;
   import java.io.IOException;
   import java.io.InputStream;
   import java.sql.Connection;
   import java.util.Properties;
   
   /**
    * Created with IntelliJ IDEA.
    * PackgeName: com.hengyu
    * ClassName: DruidDemo
    * Author: hengyu
    * Date: 2020/9/20 18:21
    * project name: jdbc
    * Version:
    * Description: Druid项目演示
    */
   public class DruidDemo {
   
       public static void main(String[] args) throws Exception {
           //定义配置文件
           //加载配置文件
           Properties properties = new Properties();
           InputStream inputStream = DruidDemo.class.getClassLoader().getResourceAsStream("druid.properties");
           properties.load(inputStream);
           //获取连接池对象
           DataSource dataSource = DruidDataSourceFactory.createDataSource(properties);
           System.out.println(dataSource);
           Connection connection=dataSource.getConnection();
           System.out.println(connection);
       }
   }
   ```
   
   ## druid工具类
   
   ```java
   package utils;
   
   import com.alibaba.druid.pool.DruidDataSourceFactory;
   
   import javax.sql.DataSource;
   import java.io.IOException;
   import java.sql.Connection;
   import java.sql.ResultSet;
   import java.sql.SQLException;
   import java.sql.Statement;
   import java.util.Properties;
   
   /**
    * Created with IntelliJ IDEA.
    * PackgeName: utils
    * ClassName: JDBCUtils
    * Author: hengyu
    * Date: 2020/9/22 20:29
    * project name: jdbc
    * Version:
    * Description: Druid连接池的工具类
    */
   public class JDBCUtils {
   
       /**
        * 定义成员变量
        */
       private static DataSource dataSource;
   
       static {
           try {
               //加载配置文件
               Properties properties = new Properties();
               properties.load(JDBCUtils.class.getClassLoader().getResourceAsStream("druid.properties"));
               //获取DataSource
               dataSource = DruidDataSourceFactory.createDataSource(properties);
           } catch (IOException e) {
               e.printStackTrace();
           } catch (Exception e) {
               e.printStackTrace();
           }
       }
   
       /**
        * 获取连接的方法
        */
       public static Connection getConnection() throws SQLException {
           return dataSource.getConnection();
       }
   
       /**
        * 释放资源
        */
       public static void close(Statement statement, Connection connection) throws SQLException {
           if (statement != null) {
               statement.close();
           }
           if (connection != null) {
               connection.close();
           }
       }
   
       public static void close(ResultSet resultSet, Statement statement, Connection connection) throws SQLException {
           if (resultSet != null) {
               resultSet.close();
           }
           if (statement != null) {
               statement.close();
           }
           if (connection != null) {
               connection.close();
           }
       }
   
       /**
        * 获取连接方法
        */
       public static DataSource getDataSource(){
           return dataSource;
       }
   }
   
   ```
   
   
